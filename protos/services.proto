syntax = "proto3";

enum ModelCategory {
  VISIONCLASSIFICATION = 0;
  TEXTGENERATION = 1;
  IMAGESEGMENTATION = 2;
  IMAGECAPTIONING = 3;
}

message GetModelsReq {}

message ModelResponse {
  string typeString = 1;
    TextGenerationResponse text = 2;
    VisionClassificationResponse vision = 3;
    ImageSegmentationResponse segment = 4;
}

message GetModelsResp {
  message Model {
    string model_name = 1;
    ModelCategory model_category = 2;
  }
  repeated Model models = 1;
}

message TextGenerationRequest {
  string input_phrase = 1;
  float temperature = 2; 

  string model_name = 3;
}
message TextGenerationResponse {
  repeated string generated_texts = 1;
}

message VisionClassificationRequest {
  string input_image = 1;
  uint32 num_returns = 2;

  string model_name = 3;
}

message VisionClassificationResponse {
  message Result {
    uint32 rank = 1;
    string category = 2;
    float proba = 3;
  }

  repeated Result results = 1;
}

message ImageSegmentationRequest {
  string input_image = 1;
  
  string model_name = 2;
}

message ImageSegmentationResponse {
  string output_image = 1;
}    

message ImageDownloadRequest {
  string url = 1;
}
message ImageDownloadResponse {
  string image = 1;
}

service Model {
  rpc VisionClassification(VisionClassificationRequest)
      returns (ModelResponse) {}

  rpc TextGeneration(TextGenerationRequest)
      returns (ModelResponse) {}

  rpc ImageSegmentation(ImageSegmentationRequest)
      returns (ModelResponse) {}

  rpc GetImage(ImageDownloadRequest) returns (ImageDownloadResponse) {}
  rpc ListModels(GetModelsReq) returns (GetModelsResp) {}
}
